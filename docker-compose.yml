services:
  apiserver:
    build:
      context: .
      dockerfile: Dockerfile-python-services
    volumes:
      - ./db.sqlite:/app/db.sqlite
      - /etc/is_my_prod:/container_host_is_prod:ro
    ports:
      - "8000:8000"
    command:
      - python
      - apiserver/manage.py
      - runserver
      - 0.0.0.0:8000
    depends_on:
      - redis
    restart: unless-stopped

  ui:
    build:
      context: ./ui
      dockerfile: Dockerfile
    ports:
      - "80:80"
    depends_on:
      - apiserver
    restart: unless-stopped

  tasks:
    build:
      context: .
      dockerfile: Dockerfile-python-services
    volumes:
      - ./db.sqlite:/app/db.sqlite
      - /etc/is_my_prod:/container_host_is_prod:ro
    command:
      - python
      - main.py
    depends_on:
      - redis
    restart: unless-stopped

#  phpliteadmin:
#    hostname: phpliteadmin
#    build:
#      context: ./phpliteadmin
#      dockerfile: Dockerfile
#    volumes:
#      - ./db.sqlite:/var/www/html/db.sqlite
#    restart: unless-stopped

  redis:
    image: redis:alpine
    command: ["redis-server", "/usr/local/etc/redis/redis.conf"]
    volumes:
      - ./redis-data:/data
      - ./redis.conf:/usr/local/etc/redis/redis.conf
    ports:
      - "6379:6379"
    restart: unless-stopped
