<cdk-virtual-scroll-viewport
  *ngIf="dataSource"
  headerHeight="50"
  class="table-container"
  appendOnly
  [tvsItemSize]="tableItemHeightPx"
  [headerEnabled]="true"
>
  <table
    mat-table
    matSort
    [dataSource]="dataSource"
  >

    <ng-container matColumnDef="logo" sticky>
      <th mat-header-cell *matHeaderCellDef>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
      <td mat-cell *matCellDef="let instrument">
        <div class="logo">
          <instrument-logo
            [instrumentUid]="instrument.uid"
          ></instrument-logo>
          <span class="instrument-name">{{ instrument.name }}</span>
          <a
            class="logo"
            [routerLink]="['/ticker', instrument.ticker]"
          >
            <span class="ticker">[{{ instrument.ticker}}]</span>
          </a>

          @if (instrument.for_qual_investor_flag) {
            <span title="for_qual_investor_flag - –î–ª—è –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤">üö©</span>
          }
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="fundamental">
      <th mat-header-cell *matHeaderCellDef>–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</th>
      <td mat-cell *matCellDef="let instrument">
        <fundamentals
          [instrumentUid]="instrument.uid"
          [ticker]="instrument.ticker"
        ></fundamentals>
      </td>
    </ng-container>

    <ng-container matColumnDef="complex">
      <th mat-header-cell *matHeaderCellDef>–ì–æ–¥ –∏—Å—Ç–æ—Ä–∏–∏ + –ø–æ–ª–≥–æ–¥–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤</th>
      <td mat-cell *matCellDef="let instrument">
        <complex-graph
          width="700px"
          height="250px"
          [instrumentUid]="instrument.uid"
          [instrumentTicker]="instrument.ticker"
          [interval]="CandleInterval.CANDLE_INTERVAL_WEEK"
          [historyDaysCount]="365"
          [futureDaysCount]="180"
          [isShowForecasts]="true"
          [isShowLegend]="false"
        ></complex-graph>
      </td>
    </ng-container>

    <ng-container matColumnDef="balance">
      <th mat-header-cell *matHeaderCellDef>–ë–∞–ª–∞–Ω—Å</th>
      <td mat-cell *matCellDef="let instrument">
        <balance
          [instrumentUid]="instrument.uid"
          [instrumentFigi]="instrument.figi"
        ></balance>
        <!--        <br>-->
        <!--        <br>-->
        <!--        <recommendation-->
        <!--          [instrumentUid]="instrument.uid"-->
        <!--          [isLong]="false"-->
        <!--        ></recommendation>-->
      </td>
    </ng-container>

    <ng-container matColumnDef="forecast">
      <th mat-header-cell *matHeaderCellDef>–ü—Ä–æ–≥–Ω–æ–∑ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤</th>
      <td mat-cell *matCellDef="let instrument">
        <forecast [instrumentUid]="instrument.uid"></forecast>
        <br>
        <br>
        <forecast-history [instrumentUid]="instrument.uid"></forecast-history>
      </td>
    </ng-container>

    <ng-container matColumnDef="prediction">
      <th mat-header-cell *matHeaderCellDef>–¶–µ–Ω–∞ + –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –º–µ—Å—è—Ü</th>
      <td mat-cell *matCellDef="let instrument">
        <div>
          –¢–µ–∫—É—â–∞—è: <b>{{ instrument.uid | currentPriceByUid | async | priceFormat }}</b>
        </div>
        <br>
        <br>
        <prediction-dynamic [instrumentUid]="instrument.uid"></prediction-dynamic>
      </td>
    </ng-container>

    <ng-container matColumnDef="news">
      <th mat-header-cell *matHeaderCellDef>–ù–æ–≤–æ—Å—Ç–∏</th>
      <td mat-cell *matCellDef="let instrument">
        <news-complex [instrumentUid]="instrument.uid"></news-complex>
      </td>
    </ng-container>

    <ng-container matColumnDef="llm_buy_sell_rate">
      <th mat-header-cell *matHeaderCellDef>–†–µ–π—Ç–∏–Ω–≥ –ø–æ–∫—É–ø–∫–∏</th>
      <td mat-cell *matCellDef="let instrument">
        <llm-buy-sell-rate [instrumentUid]="instrument.uid"></llm-buy-sell-rate>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>

    <tr
      *matRowDef="let row; columns: displayedColumns;"
      mat-row
      [style.height.px]="tableItemHeightPx"
    ></tr>


  </table>
</cdk-virtual-scroll-viewport>


<drawer
  [(sort)]="sortTickers"
  (sortChange)="handleChangeSort()"
></drawer>
