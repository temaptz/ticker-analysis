<div class="order-card" [class.buy-card]="isBuyRec" [class.sell-card]="!isBuyRec" [class.real-card]="isReal">

  <div class="card-header">
    <span class="direction-badge" [class.buy-badge]="isBuyRec" [class.sell-badge]="!isBuyRec">
      {{ directionLabel }}
    </span>
    @if (isReal) {
      <span class="real-badge">Активная заявка</span>
    } @else {
      <span class="potential-badge">Рекомендация</span>
    }
  </div>

  @if (isReal && order) {
    <div class="card-body">
      <div class="field-row">
        <span class="field-label">Лотов запрошено</span>
        <span class="field-value">{{ order.lots_requested }}</span>
      </div>
      <div class="field-row">
        <span class="field-label">Лотов исполнено</span>
        <span class="field-value">{{ order.lots_executed }}</span>
      </div>
      <div class="field-row">
        <span class="field-label">Цена заявки</span>
        <span class="field-value">{{ getMoneyValue(order.initial_security_price) | number:'1.2-2' }} ₽</span>
      </div>
      <div class="field-row">
        <span class="field-label">Сумма заявки</span>
        <span class="field-value">{{ getMoneyValue(order.total_order_amount) | number:'1.2-2' }} ₽</span>
      </div>
      @if (order.order_date) {
        <div class="field-row">
          <span class="field-label">Дата</span>
          <span class="field-value">{{ order.order_date | date:'dd.MM.yy HH:mm' }}</span>
        </div>
      }
    </div>

    <div class="card-actions">
      @if (isLoading()) {
        <mat-spinner diameter="14"></mat-spinner>
      } @else {
        <button
          class="create-btn create-btn-cancel"
          (click)="cancelOrder()"
        >Отменить</button>
      }
    </div>

  } @else if (!isReal) {

    <div class="card-body">
      <div class="field-row">
        <span class="field-label">Цена ₽</span>
        <input
          class="edit-input"
          type="number"
          step="0.01"
          min="0.01"
          [ngModel]="editPrice()"
          (ngModelChange)="editPrice.set($event)"
        >
      </div>
      <div class="field-row">
        <span class="field-label">Лотов</span>
        <input
          class="edit-input edit-input-sm"
          type="number"
          step="1"
          min="1"
          [ngModel]="editQty()"
          (ngModelChange)="editQty.set($event)"
        >
      </div>
    </div>

    <div class="card-actions">
      @if (isLoading()) {
        <mat-spinner diameter="14"></mat-spinner>
      } @else {
        <button
          class="create-btn"
          [class.create-btn-buy]="isBuyRec"
          [class.create-btn-sell]="!isBuyRec"
          (click)="createOrder()"
          [disabled]="!recommendation() || !editPrice() || !editQty()"
        >
          {{ isBuyRec ? 'Купить' : 'Продать' }}
        </button>
      }
    </div>

    @if (errorMessage()) {
      <div class="error-msg">{{ errorMessage() }}</div>
    }

  }

</div>
