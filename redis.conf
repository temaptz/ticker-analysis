###############################################
# Redis configuration — optimized for minimal
# writes on SSD/SD (Raspberry Pi)
###############################################

# 1. Сетевые настройки
# --------------------
# Позволяем подключаться со всех интерфейсов
# (или укажите bind 127.0.0.1, если хотите только локально).
# bind 0.0.0.0
# protected-mode yes
port 6379

# 2. Ограничение памяти и политика вытеснения
# -------------------------------------------
# Допустим, мы хотим использовать до 256 МБ оперативной памяти.
# При достижении лимита Redis удалит самые "давно не используемые" ключи.
maxmemory 128mb
maxmemory-policy allkeys-lru

# 3. Отключаем AOF (Append Only File)
# -----------------------------------
# Это важно для снижения количества операций записи.
appendonly no

# 4. Используем RDB-снапшоты (периодические)
# ------------------------------------------
# Настройки ниже задают интервалы сохранения:
#   - save 900 1      -> раз в 900 сек (15 минут) при изменении >=1 ключа
#   - save 300 10     -> раз в 300 сек (5 минут) при изменении >=10 ключей
#   - save 60 10000   -> раз в 60 сек (1 мин) при изменении >=10000 ключей
# Если нагрузка небольшая, сохранения будут нечастыми.
# Хотите ещё реже? Удалите строки 300/60 и оставьте только 900.
save 900 1
save 300 10
save 60 10000

# 5. Файл RDB и рабочая директория
# --------------------------------
# Именно сюда Redis будет писать dump.rdb.
dbfilename dump.rdb
dir /data

# 6. Уровень логирования
# ----------------------
# По умолчанию 'notice'. Уменьшим до 'warning' чтобы меньше писать в логи.
# loglevel warning

# Логи по умолчанию выводятся в stdout внутри контейнера — их можно посмотреть через
# 'docker logs redis_min_write'. Если хотите писать в файл, задайте logfile "/data/redis.log".
# Но это увеличит износ носителя, поэтому лучше оставить дефолт.
# logfile "/data/redis.log"

# 7. Другие настройки
# -------------------
# Отключаем автоматический timeout простоя соединений.
# timeout 0

# TCP keepalive (в секундах).
# tcp-keepalive 300

# Для небольших устройств (типа RPi) советуют иногда:
# stop-writes-on-bgsave-error no
# но это необязательно.
###############################################
# Конец файла redis.conf
###############################################
